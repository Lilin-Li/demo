
# 後端結構

my-exchange/
	pom.xml
	bom/
	common-sdk/
		core-utils/                                       # 基礎工具、錯誤、Result，無業務型別                                                                                                  
	    web/                                                 # Web 共用配置、CORS、觀測性                         
		security/ 
			**Auth SDK**：統一登入驗證 / JWT 解析。      # 所有服務共用相同的安全邏輯	
			**ACL SDK**：統一權限驗證。
			**加密/簽名 SDK**：敏感資料保護。  
	    infra-sdk/	
			Config SDK：與配置中心（Nacos, Apollo）對接封裝。       # 提供標準化 Starter，簡化配置。  
			Redis SDK：統一序列化方式（例如 JSON/Binary）。           # 把基礎設施用法標準化，避免每個服務各自配置。
			Kafka SDK：統一 Producer/Consumer 配置。
			DB SDK：統一分頁、審計欄位處理。
	    dev-test/
			 test SDK: 共用的 Mock 工具、測試容器封裝            # 測試基底、Testcontainers
			 dev SDK:  封裝一些 Dummy Provider，方便本地跑起來 
	    observability/
		    Log SDK：統一日誌格式（traceId, spanId, userId）。        # 日誌、指標、追蹤 starter
		    Trace SDK：封裝 Sleuth / OpenTelemetry。                         # 確保全公司服務「行為一致」。   
		    Metrics SDK：統一暴露 Prometheus 指標。
  api-interfaces/
    account-api/         # OpenAPI/AsyncAPI + DTO
    marketdata-api/
    matching-api/
    risk-api/
  clients/
	 account-client/    # 由契約生成的 Feign/Retrofit/gRPC 客戶端
	 marketdata-client/
	 matching-client/
	 risk-client/
  services/  
    gateway/                                                 # API Gateway/BFF
    risk-margin/                                            # 保證金、風險限額、下單前校驗
    matching/                                                # 撮合引擎（建議獨立進程，Go/Rust/Java Disruptor）
    account-ledger/                                    # 資產賬本，雙分錄、不可變事件、對賬
		 interface/         # REST Controller、DTO、異常處理
		 app/                  # Application Service、用例編排、@Transactional 邊界
		 domain/           # Entity/ValueObject、Domain Service、Repository 介面、規則
		 infra/                  # PO、Mapper(domain↔PO)、Repository 實作、Outbox、DB Schema
    positions/                                                # 倉位、PnL、逐倉/全倉
    market-data/                                          # 行情匯聚、行情快照、WS 推送
	-以下非核心-
    funding/                                                  # 指數價、標記價、資金費率結算與保險基金
    liquidation/                                             # 強平、ADL 流程
    admin/                                                     # 風控開關、白名單、手動處置
    wallet/                                                      # 熱錢包服務，簽名與提幣流程，與賬本分離
  integration/
    e2e-tests/
    simulators/          # 壓測與撮合回放


# 交易所核心流轉

下單請求到 gateway。risk-margin 依用戶可用資產與風險規則作同步校驗。
通過後送 matching 單分片隊列，單寫者撮合產生成交與撤單事件。
成交事件同時送 market-data 與 account-ledger。
account-ledger 以雙分錄落賬並產生餘額變更事件，positions 消費並更新倉位與 PnL。
funding 依指數價計算資金費率，定時向賬本記錄費用。
liquidation 監控標記價觸發強平。
全鏈路使用 outbox + 事件去重鍵，保證最終一致。

# 資料與一致性

賬本用關係型資料庫，表設計採雙分錄（debit/credit）與不允許更新刪除，僅追加。
所有對外轉賬與內部劃轉都有全球唯一業務鍵，重放安全。
撮合引擎內存訂單簿配合快照+WAL，單標的單執行緒，按符號分片擴展。
分析與查詢側可將事件流入 ClickHouse/Elastic，採 CQRS。

# 協定與客戶端

REST 用 OpenAPI；
行情和推送考慮 WebSocket 或 gRPC stream；
內部事件用 Kafka，消息 schema 用 Protobuf/Avro 並版本化。
從契約生成客戶端替代手寫的 user-client、order-client 類模組。

# 安全與合規

錢包使用 HSM/KMS 或多簽，提幣走審批與風控流程。
風險引擎支持限價保護、爆倉保護、節流。
身份與權限走 OIDC，敏感操作二次驗證。
完整審計與報表輸出。




# 基礎設施

基礎設施:
- nacos
- Redis 作熱資料與限流。
- Mysql 作賬本與業務庫。
- Kafka
- ClickHouse 作行情與報表。
- K8S 滾動發版；
- 撮合可用獨立節點與親和性保證低延遲。
- 分布式任務 xxl-job

框架:
- Spiring Boot
- Spring MVC
- Spring Security
- Redisson
- MyBatis
- Spring Kafka
- Spring Websocket
- Spring Cloud
	- Open Feign
	- Spring Cloud Gateway
	- Seata 分布式事務




