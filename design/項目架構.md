# 後端架構概覽

## 模組與目錄結構
```
open.vincent13/
├── pom.xml
├── common-sdk/
│   ├── core/                  # 系統基礎工具、錯誤處理、錯誤碼、Result 封裝（不含業務型別）
│   ├── utils/                 # 通用開發工具
│   ├── web/                   # Web框架工具與共用配置、CORS、觀測性等
│   ├── security/              # Auth/ACL/簽名 SDK，統一登入與敏感資料保護
│   ├── mysql/                 # SDK，封裝基礎設施
│   ├── redis/                 # SDK，封裝基礎設施
│   ├── kafka/                 # SDK，封裝基礎設施
│   ├── test/                  # 測試工具（Mock、Dummy Provider）
│   └── observability/         # Log/Trace/Metrics Starter，保證全域一致的監控格式
└── services/
│   ├── exchange/      
│   │  └── xxx-service/
│   │      ├── interface/      # REST Controller、DTO、異常處理
│   │      ├── app/            # Application Service、用例編排、交易邏輯邊界
│   │      ├── domain/         # 聚合根、值物件、領域服務、Repository 介面
│   │      └── infra/          # Repository 實作、Outbox、DB Schema、映射層        
│   └── service-template/      # 新服務腳手架，示範 controller/監控樣板
├─── .github
├─── .mvn
├─── k8s
├─── bash_script
.  
```

### `common-sdk` 說明
- 扮演平台基座：統一封裝日誌、錯誤碼、驗證、安全與基礎設施，避免各服務重覆造輪子。
- 以 Maven 子模組形式供其他模組依賴；需新共用能力時，先在這裡抽象再發佈。
- 建議搭配 BOM 管理版本，確保服務引入時不會因依賴衝突破壞構建。

### `.github`
- 存放 GitHub Actions workflow、Issue/PR 模板與 Codeowners 等協作規則。
- CI/CD pipeline 預設會在這裡定義，包含建置、測試、容器化、部署與品質掃描步驟。

### `.mvn`
- Maven Wrapper 與 Maven Daemon 的設定檔所在，確保團隊使用一致的 Maven 版本與加速參數。
- `mvnd.properties` 中可調整 JVM 記憶體、守護程序配置與快取策略，提升本地與 CI 構建效能。

### `k8s`
- 收納所有 Kubernetes manifest，依服務拆分目錄（如 `k8s/exchange/`）。
- 每個服務至少包含 Deployment、Service、HPA；跨服務資源（ingress、監控配置）放在目錄根部。
- 發布時依 Deployment → Service → HPA → Ingress 的順序套用，確保依賴正確。

### `bash_script`
- 集中各類日常維運腳本，例如資料庫遷移、自動化測試、清理或集成工具。
- 建議腳本自帶說明與 `set -eo pipefail` 等防呆設定，並於 README 記錄使用方式。

## Service 共用架構守則
- 服務採分層架構：interface/app/domain/infra，保持關注點分離。
- 共用功能集中於 `common-sdk`，以 starter 與 BOM 統一依賴版本。
- 契約優先：OpenAPI/AsyncAPI 設計先行，自動生成客戶端避免手動偏差。
- 導入觀測性、SLO 與自動測試，確保品質與可回溯性。

交易所相關內容已獨立整理於 [exchange service](exchange service.md)。
本文件保留與平台無關的共用架構原則，後續將持續補充。
