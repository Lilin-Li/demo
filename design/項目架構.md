# 後端架構概覽

## 模組與目錄結構
```
open.vincent13/
├── pom.xml
├── common-sdk/
│   ├── core/                  # Spring Boot、系統工具、通用開發工具、錯誤處理、錯誤碼、Result 封裝（不含業務型別）
│   ├── spring-mvc/            # Web 框架工具與共用配置、CORS、觀測性等
│   ├── openapi/
│   │   └── exchange/
│   │      └── xxx-service/
│   │         ├── interface/         # 各服務 OpenAPI/AsyncAPI 契約檔、DTO
│   │         └── clients/           # 依契約生成的 API Client/SDK 套件
│   ├── spring-security/       # Auth/ACL/簽名 SDK，統一登入與敏感資料保護
│   ├── mysql/                 # MySQL 存取封裝、連線池與審計欄位
│   ├── redis/                 # Redis 客戶端封裝與序列化策略
│   ├── kafka/                 # Kafka Producer/Consumer 與 Template 封裝
│   ├── test/                  # 測試工具（Mock、Dummy Provider）
│   └── observability/         # Log/Trace/Metrics Starter，保證全域一致監控
│       ├── log/               # 日誌格式、Appender、審計規則
│       ├── trace/             # TraceId/SpanId 注入與傳播
│       └── metrics/           # 指標暴露、預設儀表板配置
└── services/
    ├── exchange/
    │   └── xxx-service/
    │       ├── controller/    # REST Controller、異常處理
    │       ├── app/           # Application Service、用例編排、交易邏輯邊界
    │       ├── domain/        # 聚合根、值物件、領域服務、Repository 介面
    │       └── infra/         # Repository 實作、Outbox、DB Schema、映射層
    └── service-template/      # 新服務腳手架，示範 controller/監控樣板
├── .github
├── .mvn
├── k8s
└── bash_script
```

### `common-sdk` 說明
- 扮演平台基座：統一封裝日誌、錯誤碼、驗證、安全與基礎設施，避免各服務重覆造輪子。
- 透過 Maven 子模組提供可重用組件；新增共用能力時優先在這裡抽象並發佈。
- `core` 併入原 `utils` 功能，統一提供 JSON/Result 等基礎工具，減少跨模組串接成本。
- `openapi/interface` 保存契約原始檔，`openapi/clients` 收斂生成的 SDK，建議配合自動化流程在變更時重新生成客戶端。
- 測試支援：`test/` 模組應提供 Mock、Dummy Provider、協定樣本與啟動器，形成統一的測試基座。
- 落實 API 穩定性：公開的 util、starter 與配置需以契約測試或 sample-service 驗證，避免破壞性調整。
- 嚴格控制邊界：僅放置跨服務通用技術組件；領域專屬邏輯或資料模型應留在對應服務。
- 提供使用手冊：每個子模組維護 README，列出可用配置屬性、啟用條件與版本變更。

### 依賴管理建議
- `pom.xml` 透過父 POM 聚合版本與插件設定，搭配 BOM 對齊共用依賴，減少衝突。
- 共用 Starter 應以明確的 artifactId 命名，並在發佈前完成 backward compatibility 檢查。
- 服務若需自訂版本，優先在子 POM 使用 `<dependencyManagement>` 覆寫，避免直接鎖定 transitive 依賴。

### `services`
- `exchange` 聚合各交易所核心服務，遵循 controller/app/domain/infra 四層分工，確保關注點分離。
- `service-template` 保留新服務腳手架，可作為生成新模組的參考實作。

### `.github`
- 存放 GitHub Actions workflow、Issue／PR 模板與 Codeowners 等協作規則。
- CI/CD pipeline 在此定義建置、測試、容器化、部署與品質掃描步驟。

### `.mvn`
- Maven Wrapper 與 Maven Daemon 設定所在；確保團隊使用一致的 Maven 版本與加速參數。
- `mvnd.properties` 可調整 JVM 記憶體、守護程序與快取策略，提升本地與 CI 構建效能。

### `k8s`
- 收納所有 Kubernetes manifest，依服務拆分目錄（如 `k8s/exchange/`）。
- 每個服務至少包含 Deployment、Service、HPA；跨服務資源（ingress、監控配置）放在目錄根部。
- 發布時依 Deployment → Service → HPA → Ingress 的順序套用，確保資源依賴正確。

### `bash_script`
- 集中日常維運腳本，例如資料庫遷移、自動化測試、清理或整合工具。
- 建議腳本自帶說明與 `set -eo pipefail` 等防呆設定，並於 README 記錄使用方式。

## Service 共用架構守則
- 服務採分層架構：controller/app/domain/infra，維持邏輯與基礎設施分離。
- 共用功能集中於 `common-sdk`，以 starter 與 BOM 統一依賴版本。
- 契約優先：OpenAPI/AsyncAPI 設計先行，自動生成客戶端避免手動偏差。
- 導入觀測性、SLO 與自動測試，確保品質與可回溯性。

交易所相關內容已獨立整理於 [exchange service](exchange service.md)。
本文件保留與平台無關的共用架構原則，後續將持續補充。
